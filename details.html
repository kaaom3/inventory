<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device Details</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style> body { font-family: 'Inter', sans-serif; } </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div id="details-container" class="w-full max-w-lg bg-white p-8 rounded-xl shadow-lg">
        <div id="loading" class="text-center text-gray-500">
            <p>Loading device details...</p>
        </div>
        <div id="content" class="hidden">
            <h1 id="deviceName" class="text-2xl font-bold text-gray-800 mb-2"></h1>
            <p id="deviceSub" class="text-md text-gray-500 mb-6"></p>
            <div id="deviceFields" class="space-y-3 border-t pt-4">
                <!-- Device fields will be inserted here -->
            </div>
        </div>
        <div id="not-found" class="hidden text-center text-red-500">
             <h1 class="text-2xl font-bold mb-4">Device Not Found</h1>
             <p>The device with the specified Serial Number could not be found.</p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs, limit } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAqZ-xhY6WtIu4CEMOZqITWvqlnc5vF4Ew",
            authDomain: "inventory-eedef.firebaseapp.com",
            projectId: "inventory-eedef",
            storageBucket: "inventory-eedef.appspot.com",
            messagingSenderId: "1089383656081",
            appId: "1:1089383656081:web:bb8e8237a701f356102d30"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const collectionConfigs = {
            Computers: { serialField: 'SerialNumber', nameField: 'ComputerName', subField: 'Manufacturer' },
            Monitors: { serialField: 'MonitorSerial', nameField: 'Model', subField: 'Manufacturer' },
            Audio: { serialField: 'SerialNumber', nameField: 'ItemName', subField: 'Model' }
        };

        async function findDeviceBySerial(serial) {
            for (const collectionName in collectionConfigs) {
                const config = collectionConfigs[collectionName];
                const q = query(collection(db, collectionName), where(config.serialField, "==", serial), limit(1));
                const querySnapshot = await getDocs(q);
                if (!querySnapshot.empty) {
                    const doc = querySnapshot.docs[0];
                    return { data: doc.data(), config: config };
                }
            }
            return null;
        }

        window.addEventListener('load', async () => {
            const params = new URLSearchParams(window.location.search);
            const serialNumber = params.get('sn');

            const loadingDiv = document.getElementById('loading');
            const contentDiv = document.getElementById('content');
            const notFoundDiv = document.getElementById('not-found');

            if (!serialNumber) {
                loadingDiv.style.display = 'none';
                notFoundDiv.style.display = 'block';
                return;
            }

            const result = await findDeviceBySerial(serialNumber);

            loadingDiv.style.display = 'none';

            if (result) {
                const { data, config } = result;
                document.getElementById('deviceName').textContent = data[config.nameField] || 'N/A';
                document.getElementById('deviceSub').textContent = data[config.subField] || '';
                
                const fieldsContainer = document.getElementById('deviceFields');
                fieldsContainer.innerHTML = '';
                for (const key in data) {
                    fieldsContainer.innerHTML += `
                        <div class="flex justify-between">
                            <span class="text-gray-500">${key}</span>
                            <span class="font-semibold text-gray-800 text-right">${data[key]}</span>
                        </div>
                    `;
                }
                contentDiv.style.display = 'block';
            } else {
                notFoundDiv.style.display = 'block';
            }
        });
    </script>
</body>
</html>
